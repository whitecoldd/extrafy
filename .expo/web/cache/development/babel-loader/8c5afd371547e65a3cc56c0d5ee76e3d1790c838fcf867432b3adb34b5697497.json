{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport React, { useState } from \"react\";\nimport firebase from \"firebase/compat/app\";\nimport \"firebase/firestore\";\nimport \"firebase/compat/auth\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Save = function Save(props) {\n  console.log(props.route.params.image);\n  var uri = props.route.params.image;\n  var childPath = \"post/\" + firebase.auth().currentUser.uid + \"/\" + Math.random().toString(36);\n  var _useState = useState(\"\"),\n    _useState2 = _slicedToArray(_useState, 2),\n    caption = _useState2[0],\n    setCaption = _useState2[1];\n  var uploadImg = function () {\n    var _ref = _asyncToGenerator(function* (uri) {\n      var res = yield fetch(uri);\n      var blob = yield res.blob();\n      var task = firebase.storage().ref().child(childPath).put(blob);\n      var taskProgress = function taskProgress(snapshot) {\n        console.log(\"transferred: \" + (snapshot.bytesTransferred / snapshot.totalBytes * 100).toFixed() + \" %\");\n      };\n      var taskCompleted = function taskCompleted() {\n        task.snapshot.ref.getDownloadURL().then(function (snapshot) {\n          savePostData(snapshot);\n          console.log(snapshot);\n        });\n      };\n      var taskError = function taskError(snapshot) {\n        console.log(snapshot);\n      };\n      task.on(\"state_changed\", taskProgress, taskError, taskCompleted);\n    });\n    return function uploadImg(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var savePostData = function savePostData(downloadURL) {\n    firebase.firestore().collection(\"posts\").doc(firebase.auth().currentUser.uid).collection(\"userPosts\").add({\n      downloadURL: downloadURL,\n      caption: caption,\n      created_at: firebase.firestore.FieldValue.serverTimestamp()\n    }).then(function () {\n      props.navigation.popToTop();\n    });\n  };\n  return _jsxs(View, {\n    style: {\n      flex: 1\n    },\n    children: [_jsx(Image, {\n      source: {\n        uri: uri\n      }\n    }), _jsx(TextInput, {\n      placeholder: \"Caption goes here...\",\n      onChangeText: function onChangeText(caption) {\n        return setCaption(caption);\n      }\n    }), _jsx(Button, {\n      title: \"Save post\",\n      onPress: function onPress() {\n        return uploadImg(uri);\n      }\n    })]\n  });\n};\nexport default Save;","map":{"version":3,"names":["React","useState","firebase","jsx","_jsx","jsxs","_jsxs","Save","props","console","log","route","params","image","uri","childPath","auth","currentUser","uid","Math","random","toString","_useState","_useState2","_slicedToArray","caption","setCaption","uploadImg","_ref","_asyncToGenerator","res","fetch","blob","task","storage","ref","child","put","taskProgress","snapshot","bytesTransferred","totalBytes","toFixed","taskCompleted","getDownloadURL","then","savePostData","taskError","on","_x","apply","arguments","downloadURL","firestore","collection","doc","add","created_at","FieldValue","serverTimestamp","navigation","popToTop","View","style","flex","children","Image","source","TextInput","placeholder","onChangeText","Button","title","onPress"],"sources":["D:/prog/TFT/extrafy/components/main/Save.js"],"sourcesContent":["import { View, Text, Image, TextInput, Button } from \"react-native\";\r\nimport React, { useState } from \"react\";\r\nimport firebase from \"firebase/compat/app\";\r\nimport \"firebase/firestore\";\r\nimport \"firebase/compat/auth\";\r\n\r\nconst Save = (props) => {\r\n  console.log(props.route.params.image);\r\n  const uri = props.route.params.image;\r\n  const childPath = `post/${\r\n    firebase.auth().currentUser.uid\r\n  }/${Math.random().toString(36)}`;\r\n  const [caption, setCaption] = useState(\"\");\r\n  const uploadImg = async (uri) => {\r\n    const res = await fetch(uri);\r\n    const blob = await res.blob();\r\n    const task = firebase.storage().ref().child(childPath).put(blob);\r\n\r\n    const taskProgress = (snapshot) => {\r\n      console.log(\r\n        `transferred: ${(\r\n          (snapshot.bytesTransferred / snapshot.totalBytes) *\r\n          100\r\n        ).toFixed()} %`\r\n      );\r\n    };\r\n\r\n    const taskCompleted = () => {\r\n      task.snapshot.ref.getDownloadURL().then((snapshot) => {\r\n        savePostData(snapshot);\r\n        console.log(snapshot);\r\n      });\r\n    };\r\n    const taskError = (snapshot) => {\r\n      console.log(snapshot);\r\n    };\r\n\r\n    task.on(\"state_changed\", taskProgress, taskError, taskCompleted);\r\n  };\r\n\r\n  const savePostData = (downloadURL) => {\r\n    firebase\r\n      .firestore()\r\n      .collection(\"posts\")\r\n      .doc(firebase.auth().currentUser.uid)\r\n      .collection(\"userPosts\")\r\n      .add({\r\n        downloadURL,\r\n        caption,\r\n        created_at: firebase.firestore.FieldValue.serverTimestamp(),\r\n      })\r\n      .then(function () {\r\n        props.navigation.popToTop();\r\n      });\r\n  };\r\n\r\n  return (\r\n    <View style={{ flex: 1 }}>\r\n      <Image source={{ uri: uri }} />\r\n      <TextInput\r\n        placeholder=\"Caption goes here...\"\r\n        onChangeText={(caption) => setCaption(caption)}\r\n      />\r\n      <Button title=\"Save post\" onPress={() => uploadImg(uri)} />\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default Save;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}